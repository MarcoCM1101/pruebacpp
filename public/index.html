<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <!-- Stream almacenado en una S# publico-->
    <script
      src="https://streamgnpconnect.s3.us-east-1.amazonaws.com/connect-streams-min.js?response-content-disposition=inline&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEDIaCXVzLWVhc3QtMSJGMEQCIErb%2BsZp9qs86UFfRc5scRwlGoUa0m0bfxht%2FKxGp65RAiAeWM8TbM8Yb1WiWbrRrj3iAI0J7UIS2KiaH4bnYfgAgCqIAwib%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAAaDDE2MDI2MjExMzg2MCIMWLCytzW9sQvi6lQbKtwCEklz3GV1a%2FdHCWXMA07mu3Dc1UsF2YaS1dILI1qatvpcH5WMJGb87e8KnUacvu0C%2BULAHcV6HDFFbnQAsoN6wKu1HmqdU5pf7jitmneaHcJOPcUejfTr7jzngc2YXFtHYeThGKYIaP1Pxsn%2B3dNCoi39Zcf17dYLL93SlIyeexwyv%2FN5KH1IOx1Ss8xfruB%2FCFkiQUUw22d8wfd1o5SQWNkuGrS1O6rtlU1KhjMzn6paE7m6KbBUXvuuv7Jn09m0%2BuN%2Fd3i2kXiwMvO%2Bq7vQZcaHtDzQrNJohr2NbC4iNhz2gCS%2BEw15Ou5l9FZpRN9pQC3Yh3yzEauvzciy7OWYVYKyJLjtfos%2FZ5I08kEqDZZNMAIr%2B%2BrLr7WYHI68WkL4IvMQ%2FGn2EmMrMLMWxdxDBpoviaE2ohSFnaMcCEi7WgYxDMhCF%2FpKWgany0vGnh9tyBK4%2BR%2BCTpgWFW0IML6ekLIGOogCNwQCsjc65TvpYxK7IKkRszAmW2pWriGxpxItFGei0Hra6iBXctdjpgaPrOFOHJ%2BJKimq0H6UeVs2dJtHTViedXZth6OlniNRP0Gj7if%2FSVPxY0IF8Pez24%2BWLoOlG14qr8sem3fH4Vyzk9njQ5RMdZh6WWjSHiKUiB2fAGDIaB5ZJbsoRGcAGx0nti6z4JvClQXlXRWAg4zpRjut8XPQEEQZyIsNmhiK7jRiD%2FiGiuPMHlNGiJx33vESco9d6210Swk972O0KzphsnV4aVvvlf%2Fc9wMpFEtz7i4zau9iUEvLuu%2FBaTYhOnuQi61OP2P0dRHOt05El922iKGRWUry5eL7OtZ3QvZY&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Date=20240515T012931Z&X-Amz-SignedHeaders=host&X-Amz-Expires=14400&X-Amz-Credential=ASIASKUC5ZJCPCKGHQEA%2F20240515%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Signature=c33073fa8bf00c7b849aeb21689fa2b669c395714b291a35f64b20a95eab0746"
      onload="init()"
    ></script>
    <title>TECMEX</title>
  </head>
  <body onload="init()" bgcolor="black">
    <div id="container-div" style="width: 400px; height: 500px"></div>
    <script type="text/javascript">
      var containerDiv = document.getElementById("container-div");
      var instanceURL = "https://gnpconnect.my.connect.aws/connect/ccp-v2/";

      function init() {
        connect.core.initCCP(containerDiv, {
          ccpUrl: instanceURL,
          loginPopup: true,
          loginPopupAutoClose: true,
          loginOptions: {
            autoClose: true,
            height: 600,
            width: 400,
            top: 0,
            left: 0,
          },
          region: "us-east-1",
          softphone: {
            allowFramedSoftphone: true,
            disableRingtone: false,
            ringtoneUrl: "./ringtone.mp3",
          },
          pageOptions: {
            enableAudioDeviceSettings: false,
            enablePhoneTypeSettings: true,
          },
          ccpAckTimeout: 5000,
          ccpSynTimeout: 3000,
          ccpLoadTimeout: 10000,
        });

        var agentUsername = "";
        var contactPhoneNumber = "";

        function sendData() {
          if (agentUsername && contactPhoneNumber) {
            fetch("http://54.92.195.22:8080/connect/numero", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({
                agentName: agentUsername,
                phoneNumber: contactPhoneNumber,
              }),
            })
              .then((response) => response.json())
              .then((data) => {
                console.log("Success:", data);
              })
              .catch((error) => {
                console.error("Error:", error);
              });
          }
        }

        // Obtén los detalles del agente logueado
        connect.agent(function (agent) {
          var agentName = agent.getName();
          console.log("Agent Name:", agentName);

          agentUsername = agent.getConfiguration().username;
          console.log("Agent Username:", agentUsername);
          alert("Agent Username: " + agentUsername);

          var agentConfig = agent.getConfiguration();
          console.log("Agent Configuration:", agentConfig);

          for (var key in agentConfig) {
            if (agentConfig.hasOwnProperty(key)) {
              console.log(key + ": ", agentConfig[key]);
            }
          }

          sendData(); // Intenta enviar datos después de obtener el username
        });

        connect.contact(function (contact) {
          contact.onConnected(async function (contact) {
            console.log("**********************************************");

            var cid = contact.getContactId();
            console.log("Contact ID:", cid);

            var attributeMap = contact.getAttributes();
            console.log("Attributes:", attributeMap);

            if (
              attributeMap["PhoneNumber"] &&
              attributeMap["PhoneNumber"]["value"]
            ) {
              contactPhoneNumber = attributeMap["PhoneNumber"]["value"];
              console.log("Phone Number:", contactPhoneNumber);
              alert("Phone Number: " + contactPhoneNumber);
            } else {
              console.log("Phone number attribute not found.");
            }

            console.log("**********************************************");

            sendData(); // Intenta enviar datos después de obtener el phone number
          });
        });
      }
    </script>
  </body>
</html>
