<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <!-- Stream almacenado en una S# publico-->
    <script
      src="https://streamgnpconnect.s3.us-east-1.amazonaws.com/connect-streams-min.js?response-content-disposition=inline&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEEYaCXVzLWVhc3QtMSJHMEUCIGyR%2FMPdiHXtFGYo7DDacWh4PaYsPdcz%2FIUA1vnn%2FxpeAiEAqojXLhjTAC%2ByvWyYH4TIbjzoaHOxOV2ChEsxFrgoBOgqiAMIrv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARAAGgwxNjAyNjIxMTM4NjAiDDH5BQUVLuVdDsD1GyrcAtUBmKWYjD1w1wyPtbjfD35fxem9ilYLZuxwJ1teKo8EB7xBB%2FjzxAULA0ftA0szWUwsYTJ5nfcUTdSzBa8mj7tORo8XUv8RP6tvNXcMIxMD7oStul6dIdXgWRCb3R1IlGJNs4dx%2BmrMc%2B01NPcvQFoRdL9%2BF%2FukIcTyGu6r8QlnOl93gbBrO2SKiUkk4VoL8TU%2BsYlzqIWaS8XxESBoNEusUYlW6JHu4QAHesK%2Fc9cdGMne7oTJtT0D9OWBUCsYnXmld3rKqyJib6e8CYSKr04jtdb%2FRT%2BBzq8Pi1MQYIYXGahg5hrRruXK27eqB1j9Ixppo6RY09aLACZ%2Fastl6FHHzW3lbtsKN26jaIN%2F4rMRKrac0zR2HBM2GIf8lEyR%2BNwQiweju4nWyQafuo1FKEUM6eMMpS%2FH7VSpUn56vy6EsTthPLeEosbz53CqCvW%2BIoDxCdTZGfmr4%2BuhdDDTspSyBjqHAgUJcQ6DjN1Og8y4LQcx5my1akqp7rHGlav80ZYdmOHNetucWLPTRkCYdCmop1j59SNpwSZmbQVwXP4Q5Cb7wVraFZ%2BWEHThl25yB6SDVxsCURiheuJMHpvPT3IlQi3hX5iW1rJrhljWuxu8bII%2BZ%2Bl321E8J58zsjexrpzasmbkMHx1d8yj7unmOV3wu0Fwhuev7deWm9wNdW1WDJxleHpbfcdV%2FwaoUotaBtPXcTNeGK07mFgDiEG7BnnBheVfypZjL%2FMZlQxRj%2BDcgX6aRTmewIhTMyR7HWxiTZ%2Fq0oVF4dX3LFtBlYmYvNCS%2Bbytx0t8wu72Axd8Lmz6gSR8X%2ByPjDzfwGds&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Date=20240515T211515Z&X-Amz-SignedHeaders=host&X-Amz-Expires=14400&X-Amz-Credential=ASIASKUC5ZJCIZFXZJE4%2F20240515%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Signature=251a2f7cc7c1a7812db7836eb53f3a9e9e99cd79a3b743c7bf4455867c4770df"
      onload="init()"
    ></script>
    <title>TECMEX</title>
  </head>
  <body onload="init()" bgcolor="black">
    <div id="container-div" style="width: 400px; height: 500px"></div>
    <script type="text/javascript">
      var containerDiv = document.getElementById("container-div");
      var instanceURL = "https://gnpconnect.my.connect.aws/connect/ccp-v2/";

      function init() {
        connect.core.initCCP(containerDiv, {
          ccpUrl: instanceURL,
          loginPopup: true,
          loginPopupAutoClose: true,
          loginOptions: {
            autoClose: true,
            height: 600,
            width: 400,
            top: 0,
            left: 0,
          },
          region: "us-east-1",
          softphone: {
            allowFramedSoftphone: true,
            disableRingtone: false,
            ringtoneUrl: "./ringtone.mp3",
          },
          pageOptions: {
            enableAudioDeviceSettings: false,
            enablePhoneTypeSettings: true,
          },
          ccpAckTimeout: 5000,
          ccpSynTimeout: 3000,
          ccpLoadTimeout: 10000,
        });

        var agentUsername = "";
        var contactPhoneNumber = "";

        function sendData() {
          if (agentUsername && contactPhoneNumber) {
            fetch("http://54.92.195.22:8080/connect/numero", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({
                agentName: agentUsername,
                phoneNumber: contactPhoneNumber,
              }),
            })
              .then((response) => response.json())
              .then((data) => {
                console.log("Success:", data);
              })
              .catch((error) => {
                console.error("Error:", error);
              });
          }
        }

        // Obtén los detalles del agente logueado
        connect.agent(function (agent) {
          var agentName = agent.getName();
          console.log("Agent Name:", agentName);

          agentUsername = agent.getConfiguration().username;
          console.log("Agent Username:", agentUsername);
          alert("Agent Username: " + agentUsername);

          var agentConfig = agent.getConfiguration();
          console.log("Agent Configuration:", agentConfig);

          for (var key in agentConfig) {
            if (agentConfig.hasOwnProperty(key)) {
              console.log(key + ": ", agentConfig[key]);
            }
          }

          sendData(); // Intenta enviar datos después de obtener el username
        });

        connect.contact(function (contact) {
          contact.onConnected(async function (contact) {
            console.log("**********************************************");

            var cid = contact.getContactId();
            console.log("Contact ID:", cid);

            var attributeMap = contact.getAttributes();
            console.log("Attributes:", attributeMap);

            if (
              attributeMap["PhoneNumber"] &&
              attributeMap["PhoneNumber"]["value"]
            ) {
              contactPhoneNumber = attributeMap["PhoneNumber"]["value"];
              console.log("Phone Number:", contactPhoneNumber);
              alert("Phone Number: " + contactPhoneNumber);
            } else {
              console.log("Phone number attribute not found.");
            }

            console.log("**********************************************");

            sendData(); // Intenta enviar datos después de obtener el phone number
          });
        });
      }
    </script>
  </body>
</html>
